---

- hosts: sn02
  roles:
    - { name: ferm, tags: ferm }
    - { name: supernode, tags: supernode }
    - { name: networkd, tags: networkd }
    - { name: ssh_known_hosts, tags: ssh_known_hosts }
    - { name: mesh_batman, tags: mesh_batman }
    - { name: mesh_fastd, tags: mesh_fastd }
    - { name: mesh_fastd_remotes_backbone, tags: mesh_fastd_remotes_backbone }
    - { name: mesh_fastd_remotes_peers_git, tags: mesh_fastd_remotes_peers_git }
    - { name: radv_server, tags: radv_server }
    - { name: dns_recursive, tags: dns_recursive }
    - { name: dhcp_server, tags: dhcp_server }
    - { name: gateway_announcement, tags: gateway_announcement }
    - { name: stats_batches, tags: stats_batches }
    - { name: simple_mail, tags: simple_mail }
    - { name: journald, tags: journald }
    - { name: admin, tags: admin }
    - { name: iperf3, tags: iperf3 }
    - { name: mesh_announce, tags: mesh_announce }
    - { name: cron-apt, tags: cron-apt }
    - { name: cli_tools, tags: cli_tools }
    - { name: misc, tags: misc }
    - { name: node_exporter, tags: node_exporter }
    - { name: babeld, tags: babeld }
  vars_files:
    - vars/all_hosts.yml
    - vars/domains.yml
  vars:
    - servername: sn02
    - sn: 2
    - mail_fqdn: "sn02.s.ffh.zone"
    - admin_authorized: [lemoer, cawi, luk, manawyrm, aiyion, jue, okrueger, raute, tobby, sush]
    - cron_apt_mailto: monitoring@hannover.freifunk.net

    - networkd_configures:
      - iface: eth0
        addresses:
          - 2a01:4f8:1c0c:7149::2001/64
        dhcp: true
        gateway6: fe80::1
        dns_server: [213.133.98.98, 8.8.8.8]
      - iface: bat0
        addresses:
          - 10.2.20.1/16
          - fdca:ffee:8::2001/64
        macaddress: 12:34:56:78:90:02
        no_radv_accept: true

    - networkd_tap_devices:
      - mesh_fastd

    - mesh_fastd_mac: "88:E6:40:20:20:01"
    - mesh_fastd_listen_on: [ "195.201.97.8", "2a01:4f8:1c0c:7149::2001" ]
    - mesh_fastd_port: 10000
    - git_addr: ssh://git@git.ffh.zone

    - stats_pings:
      - host: 8.8.8.8
        name: google-dns
      - host: 100.101.2.1
        name: internetz-me

    - stats_fastd_sockets:
      - name: mesh_fastd
        path: /var/run/fastd.mesh_fastd.sock

    - stats_pushgateway:
        host: "[fdca:ffee:8::108]:9091"
        job: sn02

    - stats_bpfcountd_interfaces: ['bat0']

    - reboot_on_kernelpanic: true

    - babeld_interfaces: ['gre-aegidientor']
    - babeld_supernode: true
