#
#  Configuration file for ferm(1).
#  DO NOT EDIT. Handled by ansible.
#

domain (ip ip6) {

    table filter {
        chain INPUT {
            policy DROP;

            # connection tracking
            mod state state INVALID DROP;
            mod state state (ESTABLISHED RELATED) ACCEPT;

            # allow local packet
            interface lo ACCEPT;

            # respond to ping
            proto icmp ACCEPT;
            proto ipv6-icmp ACCEPT;

            # allow SSH connections
            proto tcp dport ssh ACCEPT;
            proto tcp dport 1337 ACCEPT;

{%if sn is defined && legacy_dom0 == true %}
            interface (bat0) jump MESH_INPUT;
{% endif %}
{%if sn is defined && domains is defined %}
            interface ({% for d in domains %}bat{{d.id}} {% endfor %}) jump MESH_INPUT;
{% endif %}
        }
        chain OUTPUT {
            policy ACCEPT;

            # connection tracking
            mod state state INVALID DROP;
            mod state state (ESTABLISHED RELATED) ACCEPT;
        }
        chain FORWARD {
            policy DROP;

            # connection tracking
            mod state state INVALID DROP;
            mod state state (ESTABLISHED RELATED) ACCEPT;
        }

	chain MESH_INPUT {

	}
    }
}

@include '/etc/ferm/conf.d/';
